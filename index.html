<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hawaiʻi Names Project</title>

<link rel="icon" href="clean-favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="clean-favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="clean-favicon-16.png">
<link rel="apple-touch-icon" sizes="180x180" href="clean-favicon-180.png">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<!-- MarkerCluster (clustering) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">

<style>
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background:#f7f7f7;
    color:#222;
  }

  /* =========================
     NAVIGATION (Option A)
     Desktop: normal horizontal links
     Mobile: hamburger menu
     ========================= */
  nav{
    background:#fff;
    border-bottom:1px solid #ddd;
  }

  .nav-inner{
    max-width:1200px;
    margin:0 auto;
    padding:14px 18px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }

  .nav-links{
    display:flex;
    gap:40px;
    font-weight:600;
  }

  nav a{
    text-decoration:none;
    color:#222;
  }

  nav a:hover{ color:#2b6cb0; }

  .nav-toggle{
    position:absolute;
    opacity:0;
    width:1px;
    height:1px;
  }

  .hamburger{
    display:none;
    position:absolute;
    right:18px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
    border:0;
    background:transparent;
    padding:10px;
  }

  .hamburger span{
    display:block;
    width:24px;
    height:2px;
    background:#222;
    margin:5px 0;
  }

  .mobile-menu{
    display:none;
    border-top:1px solid #eee;
    background:#fff;
  }

  .mobile-menu a{
    display:block;
    padding:14px 18px;
    border-bottom:1px solid #f0f0f0;
    font-weight:600;
  }

  .mobile-menu a:last-child{ border-bottom:none; }

  #nav-toggle:checked ~ .mobile-menu{ display:block; }

  @media (max-width: 768px){
    .nav-inner{ justify-content:flex-start; }
    .nav-links{ display:none; }
    .hamburger{ display:block; }
  }

  /* =========================
     BANNER
     ========================= */
  .hero-banner{
    width:100%;
    background:white;
    display:flex;
    justify-content:center;
    padding:30px 0;
  }

  .hero-banner img{
    width:600px;
    max-width:90%;
    height:auto;
  }

  /* TAGLINE (compressed) */
  .tagline{
    text-align:center;
    padding:18px 20px;
    font-size:1.2rem;
    background:white;
  }

  .tagline p{
    margin:0;
    line-height:1.35;
  }

  @media (max-width:768px){
    .tagline{
      padding:12px 18px;
      font-size:1.05rem;
    }
  }

  /* FILTER SECTION */
  .filters{
    text-align:center;
    padding:18px 20px;
    background:white;
    border-top:1px solid #eee;
    border-bottom:1px solid #eee;
  }

  .filters strong{ display:inline-block; margin-bottom:10px; }

  .filters-row{
    display:flex;
    gap:16px;
    justify-content:center;
    align-items:center;
    flex-wrap:wrap;
  }

  .filters label{
    margin:0;
    font-weight:600;
    display:flex;
    gap:8px;
    align-items:center;
  }

  .btn{
    appearance:none;
    border:1px solid #ddd;
    background:#fff;
    padding:10px 14px;
    border-radius:999px;
    font-weight:700;
    cursor:pointer;
  }

  .btn:hover{ background:#f3f3f3; }

  .btn:active{ transform:translateY(1px); }

  /* MAP (Leaflet container) */
  .map{
    height:500px;   /* mobile/tablet default */
    width:100%;
  }

  /* Desktop: make it dominate more */
  @media (min-width:1024px){
    .map{ height:750px; }
  }

  /* Leaflet custom controls */
  .leaflet-control.custom-btn a{
    display:flex;
    align-items:center;
    justify-content:center;
    width:34px;
    height:34px;
    text-decoration:none;
    font-weight:700;
    color:#222;
    background:#fff;
  }

  .leaflet-control.custom-btn a:hover{ background:#f3f3f3; }

  /* Fullscreen behavior */
  #map.is-fullscreen{
    position:fixed !important;
    inset:0 !important;
    height:auto !important;
    width:auto !important;
    z-index:9999;
  }

  body.map-fullscreen{ overflow:hidden; }

  /* SECTION GRID */
  .section{
    padding:60px 20px;
    max-width:1200px;
    margin:auto;
  }

  .section h2{
    text-align:center;
    margin-bottom:40px;
  }

  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap:30px;
  }

  .card{
    background:white;
    padding:20px;
    border-radius:6px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
    position:relative;
    overflow:hidden;
  }

  /* Card “top strip” accent */
  .card::before{
    content:"";
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:6px;
    background:transparent;
  }

  /* PWL = black */
  .section-pwl .card::before{ background:#111; }

  /* PNP = green */
  .section-pnp .card::before{ background:#2f7d4a; }

  /* Stories = blue */
  .section-stories .card::before{ background:#2b6cb0; }

  .card h3{ margin-top:0; }

  /* Read link styling */
  .card a{
    display:inline-block;
    text-decoration:none;
    font-weight:700;
    color:#2b6cb0;
    margin-top:10px;
  }

  .card a:hover{ text-decoration:underline; }

  .footer{
    background:white;
    text-align:center;
    padding:40px 0;
    border-top:1px solid #ddd;
    margin-top:60px;
    font-weight:600;
    font-size:1.1rem;
  }

  .footer a{
    text-decoration:none;
    color:#222;
    margin:0 20px;
  }

  .footer a:hover{ color:#2b6cb0; }
</style>
</head>

<body>

<!-- NAV (Option A) -->
<nav>
  <input class="nav-toggle" type="checkbox" id="nav-toggle" />

  <div class="nav-inner">
    <div class="nav-links">
      <a href="#">Home</a>
      <a href="places-we-lost.html">Places We Lost</a>
      <a href="place-name-profiles.html">Place Name Profiles</a>
      <a href="stories.html">Stories</a>
    </div>

    <label class="hamburger" for="nav-toggle" aria-label="Toggle navigation">
      <span></span>
      <span></span>
      <span></span>
    </label>
  </div>

  <div class="mobile-menu">
    <a href="#">Home</a>
    <a href="places-we-lost.html">Places We Lost</a>
    <a href="place-name-profiles.html">Place Name Profiles</a>
    <a href="stories.html">Stories</a>
  </div>
</nav>

<div class="hero-banner">
  <img src="Banner.jpg" alt="Hawaiʻi Place Names Banner">
</div>

<div class="tagline">
  <p>Explore the stories behind the names that shape our islands.</p>
</div>

<div class="filters">
  <strong>Filter by:</strong>
  <div class="filters-row">
    <label><input type="checkbox" id="filter-pwl"> Places We Lost</label>
    <button class="btn" type="button" id="random-pin">Random Pin</button>
  </div>
</div>

<!-- Leaflet map container -->
<div id="map" class="map"></div>

<div class="section section-pwl">
  <h2>Places We Lost</h2>
  <div class="grid">
    <div class="card">
      <h3>Aloha Stadium</h3>
      <p>The heartbeat of statewide gatherings.</p>
      <a href="pwl-aloha-stadium.html">Read</a>
    </div>

    <div class="card">
      <h3>Wahaʻula Heiau</h3>
      <p>Buried beneath lava, but not forgotten.</p>
      <a href="pwl-wahaula-heiau.html">Read</a>
    </div>
  </div>
</div>

<div class="section section-pnp">
  <h2>Place Name Profiles</h2>
  <div class="grid">
    <div class="card">
      <h3>ʻIolani Palace</h3>
      <p>A royal name that endured.</p>
    </div>
    <div class="card">
      <h3>Parker Ranch</h3>
      <p>Land, legacy, and cattle.</p>
    </div>
  </div>
</div>

<div class="section section-stories">
  <h2>Stories</h2>
  <div class="grid">
    <div class="card">
      <h3>How Does One Own an Island?</h3>
      <p>Power, land, and identity.</p>
    </div>

    <div class="card">
      <h3>Kaʻahumanu Broke the Mold</h3>
      <p>Power, reform, and the reshaping of the Hawaiian Kingdom.</p>
      <a href="story-kaahumanu.html">Read</a>
    </div>
  </div>
</div>

<footer class="footer">
  <a href="about.html">About</a> |
  <a href="contact.html">Contact Us</a>
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- MarkerCluster (clustering) -->
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
  // --- Default "home" bounds ---
  var HOME_BOUNDS = [
    [18.75, -160.45], // SW
    [22.45, -154.65]  // NE
  ];

  var map = L.map('map', {
    zoomControl: true,
    scrollWheelZoom: false
  });

  // --- Base layers ---
  var streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  });

  // Satellite (Esri World Imagery)
  var satellite = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { attribution: 'Tiles &copy; Esri' }
  );

  streets.addTo(map);

  // Layer toggle control (top-right)
  L.control.layers(
    { "Streets": streets, "Satellite": satellite },
    null,
    { position: "topright" }
  ).addTo(map);

  // Fit view so Kauaʻi + Hawaiʻi Island don't crop on mobile
  map.fitBounds(HOME_BOUNDS, { padding: [10, 10] });

  // --- Custom control: Reset/Home ---
  var HomeControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function () {
      var container = L.DomUtil.create('div', 'leaflet-control custom-btn');
      var link = L.DomUtil.create('a', '', container);
      link.href = '#';
      link.title = 'Reset view';
      link.innerHTML = '⟲';

      L.DomEvent.disableClickPropagation(container);
      L.DomEvent.on(link, 'click', function (e) {
        L.DomEvent.preventDefault(e);
        map.fitBounds(HOME_BOUNDS, { padding: [10, 10] });
      });

      return container;
    }
  });
  map.addControl(new HomeControl());

  // --- Fullscreen toggle helper ---
  function setFullscreen(on){
    var mapEl = document.getElementById('map');

    if(on){
      document.body.classList.add('map-fullscreen');
      mapEl.classList.add('is-fullscreen');

      // enable scroll wheel zoom ONLY when fullscreen on desktop
      if(window.innerWidth >= 1024){
        map.scrollWheelZoom.enable();
      }

      setTimeout(function(){ map.invalidateSize(); }, 150);
    } else {
      document.body.classList.remove('map-fullscreen');
      mapEl.classList.remove('is-fullscreen');

      map.scrollWheelZoom.disable();
      setTimeout(function(){ map.invalidateSize(); }, 150);
    }
  }

  function isFullscreen(){
    return document.getElementById('map').classList.contains('is-fullscreen');
  }

  // --- Custom control: Fullscreen button ---
  var FullscreenControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function () {
      var container = L.DomUtil.create('div', 'leaflet-control custom-btn');
      var link = L.DomUtil.create('a', '', container);
      link.href = '#';
      link.title = 'Toggle fullscreen';
      link.innerHTML = '⛶';

      L.DomEvent.disableClickPropagation(container);
      L.DomEvent.on(link, 'click', function (e) {
        L.DomEvent.preventDefault(e);
        setFullscreen(!isFullscreen());
      });

      return container;
    }
  });
  map.addControl(new FullscreenControl());

  // ESC exits fullscreen
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape' && isFullscreen()){
      setFullscreen(false);
    }
  });

  // Keep wheel zoom behavior sane on resize
  window.addEventListener('resize', function(){
    if(isFullscreen()){
      if(window.innerWidth >= 1024) map.scrollWheelZoom.enable();
      else map.scrollWheelZoom.disable();
    }
  });

  // =========================
  // CLUSTERING + FILTERS + RANDOM
  // =========================

  // You already have a big list elsewhere. Paste/keep it here.
  // IMPORTANT: add `type: "PWL"` for your Places We Lost pins as you go.
  // If a pin has no type, it will be treated as a normal pin.
  const places = [
    // ---- EXAMPLES (keep/delete; add your real list below) ----
    // {
    //   name: "Wahaʻula Heiau",
    //   island: "Hawaiʻi (Big Island)",
    //   coords: [19.324515, -155.029435],
    //   who: "Kū (god of war, as Kū-wahaʻula)",
    //   type: "PWL",
    //   url: "pwl-wahaula-heiau.html",
    //   relevance: "..."
    // },
  ];

  function makePopupHTML(p){
    var readLink = (p.url && typeof p.url === "string" && p.url.trim() !== "")
      ? `<div style="margin-top:8px;"><a href="${p.url}" style="font-weight:700;color:#0b3d91;text-decoration:none;">Read</a></div>`
      : "";

    return `
      <div style="font-family: system-ui, sans-serif; max-width: 260px; line-height: 1.4;">
        <h3 style="margin: 0 0 4px; font-size: 15px; color: #0b3d91;">
          ${p.name || ""}
        </h3>
        <div style="font-size: 13px; color: #444; margin-bottom: 6px;">
          <strong>${p.island || ""}</strong><br>
          <em>${p.who || ""}</em>
        </div>
        <div style="font-size: 13px; color: #222; background: #f7f7f9; padding: 6px 8px; border-left: 3px solid #0b3d91; border-radius: 4px;">
          ${p.relevance || ""}
        </div>
        ${readLink}
      </div>
    `;
  }

  // Cluster groups
  const allClusters = L.markerClusterGroup({
    showCoverageOnHover: false,
    spiderfyOnMaxZoom: true,
    maxClusterRadius: 45
  });

  const pwlClusters = L.markerClusterGroup({
    showCoverageOnHover: false,
    spiderfyOnMaxZoom: true,
    maxClusterRadius: 45
  });

  // Marker arrays for Random Pin
  const allMarkers = [];
  const pwlMarkers = [];

  places.forEach(p => {
    if(!p || !p.coords) return;

    const m = L.marker(p.coords).bindPopup(makePopupHTML(p));

    allClusters.addLayer(m);
    allMarkers.push(m);

    if ((p.type || "").toUpperCase() === "PWL"){
      pwlClusters.addLayer(m);
      pwlMarkers.push(m);
    }
  });

  // Default: show all pins (if any)
  map.addLayer(allClusters);

  function showAllPins(){
    if(map.hasLayer(pwlClusters)) map.removeLayer(pwlClusters);
    if(!map.hasLayer(allClusters)) map.addLayer(allClusters);
  }

  function showPWLOnly(){
    if(map.hasLayer(allClusters)) map.removeLayer(allClusters);
    if(!map.hasLayer(pwlClusters)) map.addLayer(pwlClusters);
  }

  function randomPin(){
    const usingPWL = map.hasLayer(pwlClusters) && !map.hasLayer(allClusters);
    const list = usingPWL ? pwlMarkers : allMarkers;

    if(!list.length){
      // nothing to do
      return;
    }

    const m = list[Math.floor(Math.random() * list.length)];
    const ll = m.getLatLng();

    // zoom in a bit and open popup
    map.setView(ll, Math.max(map.getZoom(), 11), { animate: true });
    m.openPopup();
  }

  // Hook up UI
  const pwlCheckbox = document.getElementById("filter-pwl");
  if(pwlCheckbox){
    pwlCheckbox.addEventListener("change", function(){
      if(this.checked) showPWLOnly();
      else showAllPins();
    });
  }

  const randomBtn = document.getElementById("random-pin");
  if(randomBtn){
    randomBtn.addEventListener("click", randomPin);
  }
</script>

</body>
</html>
